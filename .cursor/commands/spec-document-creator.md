---
type: command
name: spec-document-creator
description: docs ディレクトリ内で仕様書を作成・維持し、複数種類（機能仕様・API仕様・アーキテクチャ仕様など）に対応できる構造を提供します。
tools: Read, Edit, Write, Grep, Glob, Bash
model: inherit
---

# Spec Document Creator

仕様書作成担当として、`docs/` 配下にある各種仕様書をテンプレートベースで生成・更新し、DocDD ワークフローと連動させます。

## いつ起動するか

- 機能仕様・API 仕様・アーキテクチャ文書などを新規作成するとき
- 文書構造やフォーマットを標準化したいとき
- 既存仕様書を更新・保守するとき
- プロジェクトのドキュメント標準を決めたいとき
- **既存コードから逆算して仕様書を整備したいとき（リバースエンジニアリング）**

## 対応するドキュメント種別

1. **機能仕様** (`feature`): 要件・ユーザーストーリー・受入基準
2. **API 仕様** (`api`): エンドポイント・リクエスト/レスポンス・認証
3. **アーキテクチャ仕様** (`architecture`): システム構成・コンポーネント関係・データフロー
4. **データベース仕様** (`database`): スキーマ・リレーション・マイグレーション
5. **連携仕様** (`integration`): 外部連携・Webhook・データ同期

## ドキュメント配置

```
docs/
├── features/          # 機能仕様
├── api/              # API 仕様
├── architecture/     # アーキテクチャ文書
├── database/         # DB スキーマ
├── integrations/     # 連携仕様
└── templates/        # テンプレート群
```

## テンプレート

テンプレートは `docs/templates/` に格納し、必要に応じて拡張します。

- `feature-template.md`
- `api-template.md`
- `architecture-template.md`
- `database-template.md`
- `integration-template.md`

## 作成フロー

### 要件ベース（フォワードエンジニアリング）

1. ドキュメント種別を決定
2. 適切なテンプレートを選択／新規作成
3. 関係者・コードベース・既存文書から情報を収集
4. テンプレート構造に従って文書を作成
5. 内容の完整性とプロジェクト標準との整合性を確認

### コードからの逆算（リバースエンジニアリング）

1. 対象コード（ファイル・モジュール）を特定
2. 生成すべきドキュメント種別を決定
3. Kiri MCP / Serena MCP で構造を解析
4. エンドポイント・コンポーネント・データ構造など必要情報を抽出
5. 仕様書を作成し、コードと差異がないか検証

## リバースエンジニアリングに使う主なツール

- **Kiri MCP**: セマンティック検索・依存関係解析・スニペット抽出
  - `mcp__kiri__context_bundle`
  - `mcp__kiri__files_search`
  - `mcp__kiri__deps_closure`
  - `mcp__kiri__snippets_get`
- **Serena MCP**: シンボルベースのコード解析
  - `mcp__serena__find_symbol`
  - `mcp__serena__find_referencing_symbols`
  - `mcp__serena__list_dir`

## 種別別の抽出ポイント

### 機能仕様

- 対象: コンポーネント、ページ、フック、関連ユーティリティ
- 抽出: エントリポイント、コンポーネント階層、props/state、ユーザーフロー、バリデーション、依存関係、エラーハンドリング

### API 仕様

- 対象: `app/api/**/route.ts` や API クライアント、型定義
- 抽出: HTTP メソッド・パス、リクエスト/レスポンス型、認証/認可、ステータスコード、エラー形式

### アーキテクチャ仕様

- 対象: ディレクトリ構造、設定ファイル、主要アプリケーションコード
- 抽出: モジュール構成、データフロー、状態管理、使用技術、ビルド/デプロイ設定、環境変数

### データベース仕様

- 対象: ORM モデル、マイグレーション、DB 型定義
- 抽出: テーブル・フィールド、リレーション、インデックス、制約、マイグレーション履歴

## リバースエンジニアリング例（API）

```
1. mcp__kiri__files_search で API ルートを列挙
2. 各 route.ts を mcp__serena__find_symbol で解析（GET/POST など）
3. リクエスト/レスポンス型を抽出
4. 依存関数やクライアントを調査
5. 抽出内容を API 仕様テンプレートに反映
```

## コード解析チェックリスト

### 解析前

- [ ] 対象ファイル／ディレクトリの特定
- [ ] 生成する文書種別の決定
- [ ] コードベースの全体構造を把握
- [ ] エントリポイントを確認

### 解析中

- [ ] Kiri MCP で文脈／依存関係を取得
- [ ] Serena MCP でシンボル参照を調査
- [ ] 必要な情報を漏れなく抽出
- [ ] パターンや規約を記録
- [ ] 依存関係・関連機能を把握

### 文書化後

- [ ] コードとの整合性を確認
- [ ] コメント等から不足情報を補完
- [ ] 実装ノートや注意点を追加
- [ ] ソースコードへのリンクを記載
- [ ] 全体をレビュー

## 仕様書フォーマット例

### 機能仕様テンプレート

```markdown
# [機能名]

## 概要

機能の概要説明。

## ユーザーストーリー

- [ユーザー種別] として、[目的] がしたい。なぜなら [利点] があるからだ。

## 要件

- [ ] 要件 1
- [ ] 要件 2

## 受入基準

- [ ] 基準 1
- [ ] 基準 2

## 技術詳細

実装上の注意や補足。

## 依存関係

- 関連機能や外部システム

## テスト戦略

テスト方針や範囲。

## スケジュール

想定スケジュールやフェーズ。
```

### API 仕様テンプレート

````markdown
# [API 名]

## 概要

API の説明。

## エンドポイント

### [エンドポイント名]

- **Method**: GET/POST/PUT/DELETE
- **Path**: `/api/v1/...`
- **Description**: エンドポイントの説明

#### Request

```json
{
  "field": "type"
}
```
````

#### Response

```json
{
  "field": "type"
}
```

## Authentication

認証要件。

## Error Handling

エラーのレスポンス形式。

````

### アーキテクチャ仕様テンプレート
```markdown
# [システム/コンポーネント名]

## 概要
システムまたはコンポーネントの概要。

## アーキテクチャ図
[図の埋め込みや参照]

## コンポーネント
- コンポーネント1: 説明
- コンポーネント2: 説明

## データフロー
データの流れ。

## 技術スタック
使用技術。

## スケーラビリティ
性能・拡張性の考慮事項。
````

## ファイル命名規則

- ファイル名は `kebab-case`
- 種別に応じて接頭辞を付与（例: `feature-`、`api-`、`arch-`）
- 必要に応じて日付やバージョンを付加（例: `feature-user-auth-2024-11.md`）
- 例:
  - `feature-user-authentication.md`
  - `api-user-endpoints.md`
  - `arch-payment-system.md`

## 品質チェックリスト

- [ ] ドキュメント種別が正しい
- [ ] テンプレート構造に従っている
- [ ] 必須セクションが埋まっている
- [ ] 技術的内容が正確
- [ ] 依存関係が明記されている
- [ ] 命名規則に従っている
- [ ] 適切なディレクトリに配置されている
- [ ] 関連文書へのリンクが記載されている

## 拡張ガイド

新しいドキュメント種別を追加する場合:

1. `docs/templates/` に新テンプレートを追加
2. 「対応するドキュメント種別」に追記
3. 必要に応じて `docs/` にディレクトリを追加
4. 作成フロー・フォーマット例を更新

## プロジェクトとの統合

- コード中のコメントから仕様書へのリンクを張る
- PR 説明に関連ドキュメントを添付
- 機能更新時は仕様書も更新
- 廃止文書は `docs/archive/` などへ移動

## 作成例

### 機能仕様を作成

```
種別: feature
名前: User Authentication
テンプレート: feature-template.md
出力: docs/features/feature-user-authentication.md
```

### API 仕様を作成

```
種別: api
名前: User API Endpoints
テンプレート: api-template.md
出力: docs/api/api-user-endpoints.md
```

### リバースエンジニアリング例（API）

```
ソース: app/api/users/route.ts
種別: api
名前: User API Endpoints
手法: Reverse Engineering
出力: docs/api/api-user-endpoints.md

手順:
1. route.ts を Kiri MCP で解析
2. GET/POST/PUT/DELETE のハンドラを抽出
3. Request/Response 型を抽出
4. API 仕様テンプレートに転記
```

### リバースエンジニアリング例（機能）

```
ソース: app/users/page.tsx, components/user/*.tsx
種別: feature
名前: User Management Feature
手法: Reverse Engineering
出力: docs/features/feature-user-management.md

手順:
1. ページと関連コンポーネントを分析
2. ユーザーフロー・インタラクションを抽出
3. 状態管理とビジネスロジックを整理
4. 機能仕様テンプレートに反映
```

## タスクチェックリスト

### フォワードエンジニアリング

- [ ] 文書種別を確定
- [ ] テンプレートの有無を確認／作成
- [ ] 必要な要件や情報を収集
- [ ] テンプレートに沿って作成
- [ ] 命名規則と配置場所を確認
- [ ] 完成後レビューと技術的整合性チェック

### リバースエンジニアリング

- [ ] 対象コードと種別を確定
- [ ] Kiri／Serena MCP を準備
- [ ] 必要情報（エンドポイント・コンポーネント・型など）を抽出
- [ ] テンプレートにマッピング
- [ ] ソースコード参照や実装ノートを追記
- [ ] 仕上げに整合性と網羅性を確認

このコマンドを使うことで、プロジェクトの仕様ドキュメントが一貫した形式で整備され、DocDD の各フェーズで参照しやすくなります。
