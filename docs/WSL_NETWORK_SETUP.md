# WSL2でスマホから開発サーバーにアクセスする方法

## 現在の設定状況

- **WSL2のIPアドレス**: `192.168.93.20`
- **ホストマシン（Windows）のIPアドレス**: `192.168.93.1`
- **開発サーバーポート**: `3000`

## 設定手順

### 1. Next.js開発サーバーの設定（✅ 完了）

`package.json`の`dev`スクリプトを`next dev -H 0.0.0.0`に変更済みです。
これで、すべてのネットワークインターフェースでリッスンするようになります。

### 2. Windows側のファイアウォール設定

Windows側でポート3000を許可する必要があります。

#### 方法A: PowerShell（管理者権限で実行）

```powershell
# インバウンドルールを追加（ポート3000を許可）
New-NetFirewallRule -DisplayName "WSL2 Next.js Dev Server" -Direction Inbound -LocalPort 3000 -Protocol TCP -Action Allow
```

#### 方法B: コントロールパネルから設定

1. Windowsの「設定」→「プライバシーとセキュリティ」→「Windowsセキュリティ」→「ファイアウォールとネットワーク保護」
2. 「詳細設定」をクリック
3. 「受信の規則」を選択
4. 「新しい規則」をクリック
5. 「ポート」を選択→「次へ」
6. 「TCP」を選択し、「特定のローカルポート」に`3000`を入力→「次へ」
7. 「接続を許可する」を選択→「次へ」
8. すべてのプロファイルにチェック→「次へ」
9. 名前を「WSL2 Next.js Dev Server」などに設定→「完了」

### 3. 開発サーバーの起動

```bash
cd src
yarn dev
# または
npm run dev
```

サーバーが起動すると、以下のように表示されます：
```
- Local:        http://localhost:3000
- Network:      http://0.0.0.0:3000
```

### 4. スマホからアクセス

スマホとPCが同じWi-Fiネットワークに接続されていることを確認してください。

#### ホストマシンのIPアドレスを確認

Windows側で以下のコマンドを実行：
```powershell
ipconfig
```

「イーサネット アダプター」または「ワイヤレス LAN アダプター」の「IPv4 アドレス」を確認します。
例: `192.168.1.100`

#### スマホのブラウザでアクセス

```
http://[ホストマシンのIPアドレス]:3000
```

例: `http://192.168.1.100:3000`

**注意**: WSL2のIPアドレス（`192.168.93.20`）ではなく、**WindowsホストマシンのIPアドレス**を使用してください。

### 5. トラブルシューティング

#### 接続できない場合

1. **ファイアウォールの確認**
   ```powershell
   # PowerShell（管理者権限）で実行
   Get-NetFirewallRule | Where-Object {$_.DisplayName -like '*3000*'}
   ```

2. **ポートがリッスンされているか確認**
   ```bash
   # WSL2側で実行
   netstat -tuln | grep 3000
   ```

3. **Windows側でポートが開いているか確認**
   ```powershell
   # PowerShell（管理者権限）で実行
   netstat -ano | findstr :3000
   ```

4. **同じネットワークに接続されているか確認**
   - スマホとPCが同じWi-Fiネットワークに接続されていることを確認
   - モバイルデータではなく、Wi-Fiを使用していることを確認

#### WSL2のIPアドレスが変わった場合

WSL2を再起動するとIPアドレスが変わる可能性があります。
ホストマシンのIPアドレスは通常変わらないため、ホストマシンのIPアドレスを使用することを推奨します。

## 参考情報

- **WSL2のIPアドレス確認**: `hostname -I`
- **ホストマシンのIPアドレス確認**: Windows側で`ipconfig`を実行
- **デフォルトゲートウェイ**: `ip route show | grep default`

